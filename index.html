<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–í–µ—Å—ñ–Ω—è –ü—Ä–∞—Ü—è</title>
<style>
body {margin:0; font-family:Arial; background:#000; color:#90ee90; position:relative; min-height:100vh; overflow-x:hidden;}
body::before {content:"–í–µ—Å—ñ–Ω—è –ü—Ä–∞—Ü—è"; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); font-size:200px; color:rgba(144,238,144,0.05); font-weight:bold; white-space:nowrap; z-index:0; pointer-events:none;}
header {background:#111; padding:20px; text-align:center; font-size:26px; position:relative; z-index:2;}
.container {padding:20px; max-width:1300px; margin:auto; position:relative; z-index:2;}
.search-box {text-align:center; margin-bottom:15px; color:#90ee90;}
.search-box input {padding:11px; width:275px; border:none; color:#de9210;}
.products {display:grid; grid-template-columns:repeat(3,1fr); gap:22px; position:relative; z-index:2;}
.product {background:#111; padding:10px; border:5px solid #90ee90; text-align:center;}
.product img {width:100%; aspect-ratio:1/1; object-fit:cover; cursor:pointer;}
button {padding:8px 25px; border:none; background:#90ee90; font-weight:bold; cursor:pointer; margin-top:10px;}
button:hover{background:#6edc6e;}
.edit-btn{background:orange; color:black;}
.modal{display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); justify-content:center; align-items:center; z-index:3;}
.modal-content{background:#111; padding:50px; border:1px solid #90ee90; width:90%; max-width:400px; text-align:center;}
.modal-content img{width:100%; aspect-ratio:1/1; object-fit:cover;}
input, textarea, select{width:100%; padding:8px; margin:5px 0; border:none;}
.leaf{position:fixed; top:-50px; font-size:24px; color:#32CD32; z-index:1; pointer-events:none; user-select:none; animation-name:fall; animation-timing-function:linear;}
@keyframes fall{0%{transform:translateY(0) rotate(0deg); opacity:1;}100%{transform:translateY(110vh) rotate(360deg); opacity:0;}}
@media(max-width:900px){.products{grid-template-columns:repeat(2,1fr);}}
@media(max-width:600px){.products{grid-template-columns:1fr;}.search-box input{width:100%;} body::before{font-size:80px;}}
</style>
</head>
<body>
<header>üõí –í–µ—Å—ñ–Ω—è –ü—Ä–∞—Ü—è</header>
<div class="container">
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="–ü–æ—à—É–∫ —Ç–æ–≤–∞—Ä—É..." onkeyup="handleSearch()">
    <select id="categoryFilter" onchange="filterCategory()"><option value="">–í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</option></select>
  </div>
  <div style="text-align:center;">
    <button id="addProductBtn" style="display:none;" onclick="openAddModal()">–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä</button>
    <button id="manageCategoriesBtn" style="display:none;" onclick="openCategoryModal()">–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</button>
  </div>
  <div class="products" id="products"></div>
</div>

<!-- –ú–æ–¥–∞–ª–∏ -->
<div class="modal" id="viewModal">
  <div class="modal-content">
    <img id="modalImg">
    <h3 id="modalTitle"></h3>
    <p id="modalPrice"></p>
    <p id="modalDesc"></p>
    <p id="modalCategory"></p>
    <button onclick="closeModal()">–ù–∞–∑–∞–¥</button>
  </div>
</div>

<div class="modal" id="editModal">
  <div class="modal-content">
    <h3 id="editTitleText">–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä</h3>
    <input type="text" id="editTitle" placeholder="–ù–∞–∑–≤–∞">
    <input type="number" id="editPrice" placeholder="–¶—ñ–Ω–∞">
    <input type="file" id="editImageFile" accept="image/*">
    <textarea id="editDesc" placeholder="–û–ø–∏—Å"></textarea>
    <select id="editCategory"></select>
    <button onclick="saveProduct()">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
    <button onclick="closeEditModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    <button id="deleteBtn" onclick="deleteProduct()" style="background:red;color:white;display:none;margin-top:5px;">–í–∏–¥–∞–ª–∏—Ç–∏</button>
  </div>
</div>

<div class="modal" id="categoryModal">
  <div class="modal-content">
    <h3>–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</h3>
    <div id="categoryList"></div>
    <input type="text" id="newCategory" placeholder="–ù–æ–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è">
    <button onclick="addCategory()">–î–æ–¥–∞—Ç–∏</button>
    <button onclick="closeCategoryModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>

<script>
// Firebase –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
const firebaseConfig = {
  apiKey: "AIzaSyCPEYu_S1qn9dwCkh22QzyX4-hB4_ecM0A",
  authDomain: "vesinya-pratsya-shop.firebaseapp.com",
  databaseURL: "https://vesinya-pratsya-shop-default-rtdb.firebaseio.com",
  projectId: "vesinya-pratsya-shop",
  storageBucket: "vesinya-pratsya-shop.firebasestorage.app",
  messagingSenderId: "352467558248",
  appId: "1:352467558248:web:fd2c80d6be6d837cff80dd",
  measurementId: "G-NMM6FYEYT8"
};

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Firebase
firebase.initializeApp(firebaseConfig);
firebase.analytics();
const db = firebase.database();

// –ü–∞–¥–∞—é—á–µ –ª–∏—Å—Ç—è
function createLeaf(){
  const leaf=document.createElement('div');
  leaf.className='leaf';
  leaf.style.left=Math.random()*window.innerWidth+'px';
  leaf.style.fontSize=12+Math.random()*24+'px';
  leaf.style.animationDuration=5+Math.random()*5+'s';
  leaf.innerHTML='üçÉ';
  document.body.appendChild(leaf);
  setTimeout(()=>leaf.remove(),10000);
}
setInterval(createLeaf,500);

// –ú–∞–≥–∞–∑–∏–Ω
let adminMode=false;
let editingId=null;
let products = [];
let categories = [];

// –°–ª—É—Ö–∞—î–º–æ Firebase
db.ref('products').on('value', snapshot => {
  products = snapshot.val() || [];
  renderProducts();
});
db.ref('categories').on('value', snapshot => {
  categories = snapshot.val() || [];
  populateCategorySelects();
});

function saveToDatabase(){
  db.ref('products').set(products);
  db.ref('categories').set(categories);
}

// –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó
function populateCategorySelects(){
  const editCat=document.getElementById("editCategory");
  const filterCat=document.getElementById("categoryFilter");
  editCat.innerHTML="<option value=''>–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</option>";
  filterCat.innerHTML="<option value=''>–í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</option>";
  categories.forEach(cat=>{
    editCat.innerHTML+=`<option value="${cat}">${cat}</option>`;
    filterCat.innerHTML+=`<option value="${cat}">${cat}</option>`;
  });
  populateCategoryList();
}

function renderProducts(list=products){
  const container=document.getElementById("products");
  container.innerHTML="";
  list.forEach(p=>{
    container.innerHTML+=`
    <div class="product">
      <img src="${p.image}" onclick="openViewModal(${p.id})">
      <h4>${p.title}</h4>
      <p>${p.price} –≥—Ä–Ω</p>
      <p>${p.category||""}</p>
      ${adminMode?`<button class="edit-btn" onclick="openEditModal(${p.id})">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>`:""}
      <button onclick="orderProduct('${encodeURIComponent(p.title)}', ${p.price})">–ó–∞–º–æ–≤–∏—Ç–∏</button>
    </div>`;
  });
}

function orderProduct(title,price){
  const url=`https://t.me/Fushan90?text=${encodeURIComponent(`–•–æ—á—É –∑–∞–º–æ–≤–∏—Ç–∏ ${decodeURIComponent(title)} –∑–∞ ${price} –≥—Ä–Ω`)}`;
  window.open(url,"_blank");
}

function handleSearch(){
  let value=document.getElementById("searchInput").value.toLowerCase();
  if(value==="0990"){
    adminMode=true;
    document.getElementById("addProductBtn").style.display="inline-block";
    document.getElementById("manageCategoriesBtn").style.display="inline-block";
    renderProducts();
    return;
  }
  adminMode=false;
  document.getElementById("addProductBtn").style.display="none";
  document.getElementById("manageCategoriesBtn").style.display="none";
  let filtered=products.filter(p=>p.title.toLowerCase().includes(value));
  renderProducts(filtered);
}

function filterCategory(){
  const cat=document.getElementById("categoryFilter").value;
  if(!cat){renderProducts(); return;}
  renderProducts(products.filter(p=>p.category===cat));
}

// –ú–æ–¥–∞–ª–∏
function openViewModal(id){let p=products.find(x=>x.id===id);document.getElementById("modalImg").src=p.image;document.getElementById("modalTitle").innerText=p.title;document.getElementById("modalPrice").innerText=p.price+" –≥—Ä–Ω";document.getElementById("modalDesc").innerText=p.desc;document.getElementById("modalCategory").innerText=p.category?"–ö–∞—Ç–µ–≥–æ—Ä—ñ—è: "+p.category:"";document.getElementById("viewModal").style.display="flex";}
function closeModal(){document.getElementById("viewModal").style.display="none";}
function openAddModal(){editingId=null;document.getElementById("editTitleText").innerText="–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä";document.getElementById("editTitle").value="";document.getElementById("editPrice").value="";document.getElementById("editImageFile").value="";document.getElementById("editDesc").value="";document.getElementById("editCategory").value="";document.getElementById("deleteBtn").style.display="none";document.getElementById("editModal").style.display="flex";}
function openEditModal(id){let p=products.find(x=>x.id===id);editingId=id;document.getElementById("editTitleText").innerText="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ç–æ–≤–∞—Ä";document.getElementById("editTitle").value=p.title;document.getElementById("editPrice").value=p.price;document.getElementById("editDesc").value=p.desc;document.getElementById("editCategory").value=p.category||"";document.getElementById("editImageFile").value="";document.getElementById("deleteBtn").style.display="block";document.getElementById("editModal").style.display="flex";}
function closeEditModal(){document.getElementById("editModal").style.display="none";}
function saveProduct(){let title=document.getElementById("editTitle").value;let price=document.getElementById("editPrice").value;let desc=document.getElementById("editDesc").value;let category=document.getElementById("editCategory").value;let fileInput=document.getElementById("editImageFile");if(!title||!price||!desc)return alert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è");if(fileInput.files && fileInput.files[0]){let reader=new FileReader();reader.onload=function(e){saveProductData(title,price,desc,category,e.target.result);};reader.readAsDataURL(fileInput.files[0]);}else{let existingImage=null;if(editingId){existingImage=products.find(x=>x.id===editingId).image;}saveProductData(title,price,desc,category,existingImage);}}
function saveProductData(title,price,desc,category,image){if(editingId){let p=products.find(x=>x.id===editingId);p.title=title;p.price=price;p.desc=desc;p.category=category;p.image=image;}else{products.push({id:Date.now(),title,price,desc,image,category});}saveToDatabase();closeEditModal();renderProducts();}
function deleteProduct(){if(editingId){if(confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ç–æ–≤–∞—Ä?")){products=products.filter(p=>p.id!==editingId);saveToDatabase();renderProducts();closeEditModal();}}}

// –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó
function openCategoryModal(){document.getElementById("categoryModal").style.display="flex";}
function closeCategoryModal(){document.getElementById("categoryModal").style.display="none";}
function populateCategoryList(){let list=document.getElementById("categoryList");list.innerHTML="";categories.forEach(cat=>{list.innerHTML+=`<div>${cat} <button onclick="removeCategory('${cat}')">–í–∏–¥–∞–ª–∏—Ç–∏</button></div>`;});}
function addCategory(){let cat=document.getElementById("newCategory").value.trim();if(!cat)return;if(!categories.includes(cat))categories.push(cat);document.getElementById("newCategory").value="";saveToDatabase();}
function removeCategory(cat){if(confirm(`–í–∏–¥–∞–ª–∏—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é "${cat}"? –í—Å—ñ —Ç–æ–≤–∞—Ä–∏ –∑–∞–ª–∏—à–∞—Ç—å—Å—è –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó.`)){categories=categories.filter(c=>c!==cat);products.forEach(p=>{if(p.category===cat)p.category="";});saveToDatabase();}}

populateCategorySelects();
renderProducts();
</script>
</body>
</html>